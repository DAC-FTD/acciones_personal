<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ACCIÓN DE PERSONAL - UNEMI</title>
  <link rel="icon" type="image/png" href="img/logo-unemi.png">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <!-- DataTable -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <!-- JS Libraries -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script>
    window.onload = function() {
      document.getElementById('periodo').value = new Date().getFullYear();
    }
  </script>
  <style>
    body {
      font-family: 'Roboto','Open Sans', Arial, sans-serif;
      background-color: #ffffff;
      color: #1D2B4F;
    }
    .logo-tigre {
      height: 60px;
      object-fit: contain;
    }
    .logo-unemi {
      height: 50px;
      object-fit: contain;
    }
    .franja-superior {
      background-color: #1D2B4F;
      color: white;
      font-size: 22px;
      font-weight: bold;
      vertical-align: middle;
    }
    .franja-naranja {
      height: 10px;
      background-color: #F39200;
    }
  </style>
</head>
<body>
<!-- Encabezado -->
<div class="franja-superior d-flex justify-content-between align-items-center px-3">
  <div class="d-flex align-items-center">
    <img src="img/logo-unemi.png" alt="Logo" class="logo-tigre">
  </div>
  <div class="text-center flex-grow-1">
    <h2 style="color:white;" class="fw-bold"></h2>
  </div>
  <div class="d-flex align-items-center justify-content-end">
    <img src="img/unemi-logo.png" alt="Logo" class="logo-unemi">
  </div>
</div>
<div class="franja-naranja"></div>

<div class="container py-5">
  <div class="mx-auto shadow p-4 rounded-4" style="max-width: 800px; background: white;">
    <h4 class="text-center mb-3">Notificaciones para acciones de personal</h4>
    <div class="row g-4">
      <!-- Columna izquierda -->
      <div class="col-md-6">
        <div class="mb-3">
          <label class="form-label">Motivo:</label>
          <select id="motivoCombo" class="form-control rounded-3" style="margin-bottom:8px;">
            <option value="" selected disabled>Seleccione el motivo</option>
            <option>INGRESO</option>
            <option>REINGRESO</option>
            <option>RESTITUCIÓN</option>
            <option>REINTEGRO</option>
            <option>ASCENSO</option>
            <option>TRASPASO</option>
            <option>CAMBIO ADMINISTRATIVO</option>
            <option>INTERCAMBIO VOLUNTARIO</option>
            <option>LICENCIA</option>
            <option>COMISIÓN DE SERVICIOS</option>
            <option>SANCIONES</option>
            <option>INCREMENTO RMU</option>
            <option>SUBROGACIÓN</option>
            <option>ENCARGO</option>
            <option>CESACIÓN DE FUNCIONES</option>
            <option>DESTITUCIÓN</option>
            <option>VACACIONES</option>
            <option>TRASLADO</option>
            <option>REVISIÓN CLASI. PUESTO</option>
            <option value="otro">OTRO (DETALLAR)</option>
          </select>
          <input type="text" id="motivoOtro" class="form-control rounded-3 mt-2" style="display:none;" placeholder="Detalle el motivo">
        </div>
        <div class="mb-3">
          <label class="form-label">Fecha de entrega:</label>
          <input type="date" id="fechaEntrega" class="form-control rounded-3">
        </div>
        <div class="mb-3">
          <label class="form-label" style="margin-bottom:0;">Enlace del formulario:</label>
          <p class="text-muted" style="font-size: 12px; margin-bottom: 0.25rem;">Formulario donde el usuario cargará el documento legalizado</p>
          <input type="text" id="enlaceCorreoInput" class="form-control rounded-3" placeholder="Coloque aquí el enlace">
        </div>
      </div>

      <!-- Columna derecha -->
      <div class="col-md-6">
        <div class="mb-3">
          <label class="form-label">Periodo:</label>
          <input type="text" id="periodo" class="form-control rounded-3 bg-light text-secondary" readonly>
        </div>
        <div class="mb-3">
          <label class="form-label">Hora límite:</label>
          <input type="time" id="horaLimite" class="form-control rounded-3">
        </div>
        <div class="mb-3">
          <label class="form-label" style="margin-bottom:0;">Enlace de la carpeta:</label>
          <p class="text-muted" style="font-size: 12px; margin-bottom: 0.25rem;">Carpeta donde se encuentran las acciones de personal por legalizar</p>
          <input type="text" id="enlaceInput" class="form-control rounded-3" placeholder="Coloque aquí el enlace">
        </div>
      </div>
    </div>

    <!-- Botón y mensaje -->
    <div class="row mt-3">
      <div class="col-md-12 d-flex" style="justify-content: center;">
        <button class="btn btn-success text-white fw-bold rounded-5 w-25" onclick="enviarFormulario()">Enviar</button>
      </div>
    </div>
  </div>
</div>

<script>
  // Mostrar/ocultar detalle cuando es OTRO
  document.getElementById('motivoCombo').addEventListener('change', function() {
    const otro = document.getElementById('motivoOtro');
    if (this.value === 'otro' || this.selectedOptions[0]?.text === 'OTRO (DETALLAR)') {
      otro.style.display = '';
      otro.required = true;
    } else {
      otro.style.display = 'none';
      otro.value = '';
      otro.required = false;
    }
  });

  function enviarFormulario() {
    const enlace = document.getElementById('enlaceInput').value.trim();
    const enlaceCorreo = document.getElementById('enlaceCorreoInput').value.trim();
    const fecha = document.getElementById('fechaEntrega').value;
    const hora = document.getElementById('horaLimite').value;
    const motivoCombo = document.getElementById('motivoCombo');
    const motivo = motivoCombo.value || motivoCombo.selectedOptions[0]?.text || '';
    const motivoOtro = document.getElementById('motivoOtro').value.trim();
    const periodo = document.getElementById('periodo').value.trim();

    // Validación de campos
    let motivoFinal = motivo;
    if ((motivo === 'otro' || motivo.toUpperCase().includes('OTRO')) && motivoOtro) {
      motivoFinal = motivoOtro;
    } else if ((motivo === 'otro' || motivo.toUpperCase().includes('OTRO')) && !motivoOtro) {
        Swal.fire({
          icon: 'warning',
          title: 'Motivo requerido',
          text: 'Debe detallar el motivo seleccionado.',
          confirmButtonText: 'Entendido'
        });
      return;
    }

    if (enlace && enlaceCorreo && fecha && hora && motivoFinal) {
      fetch('https://hook.us2.make.com/8kgkd36w4vnyo3lmmt0kepv7kxgkob76', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          enlace: enlace,
          enlaceCorreo: enlaceCorreo,
          fechaEntrega: fecha,
          horaLimite: hora,
          motivo: motivoFinal,
          periodo: periodo
        })
      }).then(() => {
        // Limpiar campos tras enviar
        document.getElementById('enlaceInput').value = '';
        document.getElementById('enlaceCorreoInput').value = '';
        document.getElementById('fechaEntrega').value = '';
        document.getElementById('horaLimite').value = '';
        motivoCombo.value = '';
        document.getElementById('motivoOtro').value = '';
        document.getElementById('motivoOtro').style.display = 'none';
        Swal.fire({
          icon: 'success',
          title: '¡Formulario enviado!',
          text: 'La información fue registrada correctamente.',
          timer: 2500,
          showConfirmButton: false
        });
              });
    } else {
      Swal.fire({
        icon: 'error',
        title: 'Campos incompletos',
        text: 'Completa todos los campos antes de enviar.',
        confirmButtonText: 'Revisar'
      });
    }
  }
</script>
</body>
</html>
